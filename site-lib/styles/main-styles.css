/* ==========================================================================
   MASTER THEME: OBSIDIAN MODERN WEB
   ========================================================================== */

/* --------------------------------------------------------------------------
   1. VARIABLES Y CONFIGURACIÓN GLOBAL
   -------------------------------------------------------------------------- */
:root {
  --color-fade-speed: 0.2s;
  /* Configuración del Toggle de Tema (Sol/Luna) */
  --toggle-width: 3.5em;
  --toggle-height: 1.75em;
  --border-radius: calc(var(--toggle-height) / 2);
  --handle-width: calc(var(--toggle-height) * 0.65);
  --handle-radius: calc(var(--handle-width) / 2);
  --handle-margin: calc((var(--toggle-height) / 2.0) - var(--handle-radius));
  --handle-translation: calc(var(--toggle-width) - var(--handle-width) - (var(--handle-margin) * 2));
  /* Configuración de Diseño */
  --file-margins: 3rem;
  --max-width-content: 850px; /* Ancho de lectura óptimo */
}

body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif !important;
  line-height: 1.6 !important;
}

/* --------------------------------------------------------------------------
   2. DISEÑO "PÁGINA DE PAPEL" (LAYOUT)
   -------------------------------------------------------------------------- */
/* Fondo general detrás de la hoja */
.view-content {
  background-color: var(--background-secondary) !important;
}

/* La "Hoja" de contenido centrada */
.markdown-preview-sizer, 
.markdown-source-view .cm-scroller { 
  max-width: var(--max-width-content) !important;
  margin: 0 auto !important;
  padding: 40px 60px !important; /* Espacio interior de la hoja */
  border-radius: 12px;
  box-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.1); /* Sombra suave */
  background-color: var(--background-primary);
}

/* Ajustes para que el texto no toque los bordes en el modo edición */
.cm-content {
  max-width: 100%;
}

/* --------------------------------------------------------------------------
   3. ESTILOS DE CONTENIDO (TIPOGRAFÍA RICO)
   -------------------------------------------------------------------------- */
/* Títulos Generales */
h1, h2, h3, h4, h5, h6 {
  letter-spacing: -0.02em !important;
  color: var(--text-title-h1);
  margin-top: 1.5em !important;
  margin-bottom: 0.5em !important;
}

/* H1: Gradiente y subrayado */
h1 {
  font-weight: 800 !important;
  background: linear-gradient(120deg, var(--interactive-accent), var(--text-normal));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  padding-bottom: 0.5em;
  border-bottom: 2px solid var(--background-modifier-border);
}

/* H2: Barra lateral de acento */
h2 {
  font-weight: 700 !important;
  border-left: 4px solid var(--interactive-accent);
  padding-left: 10px;
}

/* Listas dentro de H1 (corrección) */
h1 li {
  translate: calc(0px - var(--list-indent)) 0;
}

/* Enlaces */
a, .cm-hmd-internal-link {
  text-decoration: none !important;
  color: var(--interactive-accent) !important;
  font-weight: 500;
  border-bottom: 1px solid transparent;
  transition: all 0.2s ease;
}

a:hover, .cm-hmd-internal-link:hover {
  border-bottom: 1px solid var(--interactive-accent);
  opacity: 0.8;
}

/* Bloques de Código */
pre, code {
  font-family: 'Fira Code', 'JetBrains Mono', monospace !important;
  font-size: 0.9em;
  background-color: var(--background-primary-alt) !important;
  border-radius: 6px;
}

/* Citas (Blockquotes) */
blockquote {
  border-left: 3px solid var(--interactive-accent) !important;
  background-color: var(--background-secondary-alt);
  padding: 1em 1.5em !important;
  border-radius: 0 8px 8px 0;
  margin-left: 0 !important;
  font-style: italic;
  color: var(--text-muted);
}

/* Listas */
ul, ol { padding-inline-start: 2em !important; }
li { margin-bottom: 0.3em; }

/* Emoji grande de página */
#webpage-icon {
  font-size: 40px;
  margin-bottom: 8px;
  font-family: emoji;
  width: fit-content;
}
#webpage-icon :is(svg, img) {
  width: 100%; height: 100%; box-shadow: none !important; border: none !important;
  border-radius: 0 !important; stroke: currentColor; margin: 0 !important; padding: 0 !important;
}
#webpage-icon :has(:is(svg, img)) { display: contents !important; }

/* Título Inline */
body.show-inline-title .page-title {
  font-weight: var(--inline-title-weight);
  font-size: var(--inline-title-size);
  color: var(--inline-title-color);
  letter-spacing: -.015em;
}

/* --------------------------------------------------------------------------
   4. NAVEGACIÓN Y EXPLORADOR DE ARCHIVOS
   -------------------------------------------------------------------------- */
#file-explorer { padding: 0 !important; }

/* Iconos y estructura del árbol */
.tree-icon {
  border: 1px solid transparent; margin: 0 4px 0 0; display: flex; align-self: center;
}
.tree-icon :is(svg, img) { width: 1em !important; height: 1em !important; }
.tree-item-self { display: flex !important; align-items: center !important; }
.tree-item-children:empty, .tree-item.filtered-out { display: none !important; }

/* Estilo de items en el explorador */
.nav-file-title, .nav-folder-title {
  border-radius: 6px;
  margin-bottom: 2px;
  line-height: var(--tree-vertical-spacing) !important;
  transition: background-color 0.2s ease;
}

.nav-file-title:hover, .nav-folder-title:hover {
  background-color: var(--background-modifier-hover) !important;
}

/* Archivo Activo (Highlight) */
.nav-file-title.is-active {
  background-color: var(--interactive-accent-hover) !important;
  color: #fff !important;
  font-weight: 600;
}

/* Carpetas raíz en negrita */
#outline .tree-item[data-depth="1"]:not(.mod-collapsible) > .tree-item-self {
  font-weight: 900; font-size: 1.05em;
}

/* Indicadores de colapso en headings (...) */
.heading.is-collapsed::after {
  content: "..." !important; display: inline-block !important; position: absolute !important;
  margin-left: .3em !important; color: var(--text-muted);
}
.heading .heading-collapse-indicator {
  opacity: 0; transition: opacity .15s ease-in-out; position: absolute; left: -2em !important;
}
.heading:hover > .heading-collapse-indicator { opacity: 1; }

/* --------------------------------------------------------------------------
   5. BOTÓN DE TEMA (SOL/LUNA ANIMADO)
   -------------------------------------------------------------------------- */
.theme-toggle-container { cursor: pointer; display: flex; align-items: center; gap: 1em; }
.theme-toggle-input { display: none; z-index: 1000; }
.toggle-background {
  position: relative; width: var(--toggle-width); height: var(--toggle-height);
  border-radius: var(--border-radius); background-color: var(--background-modifier-border);
  transition: background-color var(--color-fade-speed); z-index: 1000; animation-duration: .2s;
}
.toggle-background::before {
  content: ""; position: absolute; left: var(--handle-margin); top: var(--handle-margin);
  height: var(--handle-width); width: var(--handle-width); border-radius: var(--handle-radius);
  background-color: var(--text-normal); box-shadow: inset 0 1px 1px rgba(0, 0, 0, .2);
  animation: toggle-slide-left ease-in-out normal both; animation-duration: inherit; z-index: 1000;
}
.toggle-background::after {
  content: ""; position: absolute; right: var(--handle-margin); top: calc(var(--handle-margin));
  height: var(--handle-width); width: var(--handle-width); transition: transform .3s;
  background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-moon"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>') no-repeat center center;
  transform: scale(.9);
}
/* Estados del Toggle */
.theme-toggle-input:checked ~ .toggle-background::before { animation: toggle-slide-right ease-in-out normal both; }
.theme-toggle-input:active ~ .toggle-background::before { animation: toggle-expand-right ease-in-out normal both; }
.theme-toggle-input:active:checked ~ .toggle-background::before { animation: toggle-expand-left ease-in-out normal both; }
.theme-toggle-input:checked ~ .toggle-background::after {
  transform: translateX(calc(var(--handle-translation) * -1)) scale(.9);
  background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sun"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>') no-repeat center center;
}
/* Keyframes Toggle */
@keyframes toggle-slide-right { 0%{width:var(--handle-width);transform:translateX(0)} 50%{width:calc(var(--toggle-width)*.5)} 90%{width:var(--handle-width)} 100%{transform:translateX(var(--handle-translation))} }
@keyframes toggle-slide-left { 0%{width:var(--handle-width);transform:translateX(calc(var(--handle-translation)-((var(--toggle-width)*.33)-var(--handle-width))))} 70%{width:calc(var(--toggle-width)*.5)} 100%{width:var(--handle-width);transform:translateX(0)} }
@keyframes toggle-expand-right { 0%{width:var(--handle-width)} 100%{width:calc(var(--toggle-width)*.33)} }
@keyframes toggle-expand-left { 0%{width:var(--handle-width);transform:translateX(var(--handle-translation))} 100%{width:calc(var(--toggle-width)*.33);transform:translateX(calc(var(--handle-translation)-((var(--toggle-width)*.33)-var(--handle-width))))} }

/* --------------------------------------------------------------------------
   6. BÚSQUEDA Y GRÁFICO
   -------------------------------------------------------------------------- */
/* Búsqueda */
#search-container { --input-height: 2.6em; display: flex !important; }
#search-container::before {
  mask-image: url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><circle cx='11' cy='11' r='8'></circle><line x1='21' y1='21' x2='16.65' y2='16.65'></line></svg>");
  mask-repeat: no-repeat; top: 50%; transform: translateY(-50%); z-index: 1;
}
input[type=search] {
  box-shadow: none !important; height: var(--input-height);
  transition: background-color var(--color-fade-speed) ease-in-out;
}
.search-result a { padding: 0.5em; border-radius: 4px; width: 100%; display: block; }
.search-result a:hover { background-color: var(--nav-item-background-hover); text-decoration: underline; }

/* Gráfico */
.graph-view-wrapper { --graph-view-max-height: 35vh; }
.graph-view-container {
  border: 1px solid var(--modal-border-color); border-radius: var(--modal-radius); overflow: hidden;
}
.graph-view-container.expanded {
  position: fixed; width: 90%; height: 90%; right: 5%; top: 5%;
  background-color: var(--background-secondary); z-index: 100;
}

/* --------------------------------------------------------------------------
   7. PLUGINS (Kanban, Excalidraw, Canvas)
   -------------------------------------------------------------------------- */
#center-content .kanban-plugin { padding: 0; margin: 0; height: 100%; font-size: .875rem; }
.excalidraw-plugin { background-color: var(--background-primary); }
body.theme-dark .excalidraw-plugin svg.dark { filter: invert(93%) hue-rotate(180deg); }
.canvas-controls, .canvas-card-menu { display: none; }

/* Popovers */
.file-preview.popover.hover-popover {
  opacity: 1; min-width: var(--popover-width); height: var(--popover-height);
  box-shadow: 0 10px 30px rgba(0,0,0,0.2); border-radius: 8px;
}
.popover-action {
  background-color: var(--icon-color); mask-size: 100% 100%; mask-repeat: no-repeat;
}

/* --------------------------------------------------------------------------
   8. AJUSTES PARA MÓVIL (RESPONSIVE)
   -------------------------------------------------------------------------- */
body.is-phone .markdown-preview-sizer, 
body.is-phone .markdown-source-view .cm-scroller {
  /* En móvil, quitamos el efecto "hoja centrada" para usar toda la pantalla */
  max-width: 100% !important;
  padding: 15px !important;
  box-shadow: none !important;
  border-radius: 0;
  margin: 0 !important;
}

body.is-phone .sidebar {
  --sidebar-width: 85vw !important;
}